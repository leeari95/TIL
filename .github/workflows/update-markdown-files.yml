name: Update Markdown Files and Deploy to Pages

on:
  push:
    branches:
      - main

# GitHub Pages에 배포할 수 있도록 GITHUB_TOKEN의 권한을 설정합니다.
permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  update-markdown:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install Swift
      uses: swift-actions/setup-swift@v2

    - name: Run Swift script and check result
      working-directory: ${{ github.workspace }}
      run: |
        if swift run Scripts; then
          echo "Script executed successfully"
        else
          echo "Script execution failed"
          exit 1
        fi

    - name: Build Documentation
      working-directory: ${{ github.workspace }}
      run: |
        swift package --allow-writing-to-directory ./docs \
        generate-documentation --target AriNote \
        --disable-indexing \
        --transform-for-static-hosting \
        --hosting-base-path TIL \
        --output-path ./docs

    - name: Deploy 🚀
      uses: JamesIves/github-pages-deploy-action@v4.6.0
      with:
        branch: gh-pages
        folder: docs