{"identifier":{"url":"doc:\/\/AriNote\/documentation\/AriNote\/220923_URLSession,_CachePolicy","interfaceLanguage":"swift"},"schemaVersion":{"major":0,"minor":3,"patch":0},"variants":[{"paths":["\/documentation\/arinote\/220923_urlsession,_cachepolicy"],"traits":[{"interfaceLanguage":"swift"}]}],"metadata":{"roleHeading":"Article","role":"article","title":"220923 URLSession, CachePolicy","modules":[{"name":"Ari's Notes"}]},"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/AriNote\/documentation\/AriNote","doc:\/\/AriNote\/documentation\/AriNote\/Swift"]]},"primaryContentSections":[{"content":[{"type":"heading","text":"TIL (Today I Learned)","anchor":"TIL-Today-I-Learned","level":1},{"type":"paragraph","inlineContent":[{"text":"9월 23일 (금)","type":"text"}]},{"text":"학습 내용","type":"heading","level":2,"anchor":"%ED%95%99%EC%8A%B5-%EB%82%B4%EC%9A%A9"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"네트워크 요청 시 Response 캐시 적용 하지 않는 방법 ("},{"code":"문제 해결","type":"codeVoice"},{"text":")","type":"text"}]}]}]},{"inlineContent":[{"text":" ","type":"text"}],"type":"paragraph"},{"type":"heading","text":"고민한 점 \/ 해결 방법","level":2,"anchor":"%EA%B3%A0%EB%AF%BC%ED%95%9C-%EC%A0%90--%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95"},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/i.imgur.com\/4EWNm90.gif","type":"image"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"스타 체크 후 새로고침 시 이전 데이터를 불러와서 제대로 업데이트 되지 않는 현상"}]}],"style":"note","type":"aside","name":"Note"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"문제 상황","type":"codeVoice"},{"text":" Github API로 스타표시를 한 후, 사용자의 스타 체크한 레파지토리 목록을 불러올 때, 업데이트 된 목록이 아니라 기존에 불러왔었던 Response를 불러오는 문제로 레파지토리 목록이 업데이트가 제대로 되지 않는 현상이였다. (PUT > GET)","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"추측해보기","type":"codeVoice"},{"type":"text","text":" 왜 PUT 이후 GET을 요청했을 때, 업데이트 된 레파지토리 목록을 불러오는데 시간이 걸릴까? > API 자체적인 문제인가? 포스트맨으로도 테스트 해보자! > 정상이다. 혹시 리스폰스를 캐시처리 하나…?"}]}]}]}]},{"content":[{"inlineContent":[{"code":"이유","type":"codeVoice"},{"text":" 내 생각에는 기존에 요청해서 받았던 리스폰스가 캐싱되어 새롭게 업데이트 된 데이터를 불러오는 것이 아니라 캐시처리 되어있는 리스폰스를 불러오는 것 같다는 생각이 들었다.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"첫 번째 시도"},{"type":"text","text":" URLSessionConfiguration의 속성을 ephemeral로 할당한 후 테스트 해본 결과, 정상적으로 새롭게 업데이트 된 레파지토리를 받아왔다."}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"하지만 이걸로 해결되었다고 결론내기가 찝찝했다. 그 이유는 ephemeral 속성의 경우 다른 네트워크 요청들도 캐시가 적용되지 않는다는 점이다. 이미지의 경우는 캐시처리가 되는 것이 더 도움이 될탠데… 하는 생각이 들어서 특정 요청만 캐시처리를 하지 않도록 하고 싶었다."}]}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"type":"text","text":"그래서 다시 찾아본 결과 URLRequest 내부 속성중에는 캐시정책을 설정할 수 있는 속성이 있었다."}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"https:\/\/developer.apple.com\/documentation\/foundation\/nsurlrequest\/cachepolicy"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"inlineContent":[{"type":"text","text":"또한 아예 헤더에 Cache-Control을 할당해서 리스폰스를 캐시하지 않겠다고 하고 네트워크를 요청할 수도 있다."}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"https:\/\/www.blog-dreamus.com\/post\/cache-control-%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%EC%9D%B4%EC%9C%A0"}]}]}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"해결 방법"},{"text":" 위와 같이 URLRequest 속성중 ","type":"text"},{"code":"cachePolicy","type":"codeVoice"},{"type":"text","text":"를 "},{"code":".reloadIgnoringLocalCacheData","type":"codeVoice"},{"type":"text","text":"로 할당해주어서 해결하였다. 헤더에 Cache-Control를 할당주어 데이터를 요청 시에 Cache 관련 제어를 하는 방법도 있지만 하드코딩이라는 생각이 들어서 이러한 방법으로 해결하게 되었다."}],"type":"paragraph"}]}]},{"name":"Note","style":"note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Header를 통한 해결 방법"}]}]},{"syntax":"swift","type":"codeListing","code":["var headers: [String : String]? {","        return [","            \"Authorization\": \"token \\(KeyChainManager.shard.load(GithubAuthorize.token) ?? \"\")\",","            \"Cache-Control\": \"no-store\" \/\/ 이 부분을 추가하여 리스폰스를 캐시처리 하지 않도록 요청","        ]","    }"]},{"name":"Note","content":[{"inlineContent":[{"text":"URLRequest의 프로퍼티를 이용한 해결 방법","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside"},{"type":"codeListing","code":["var request = URLRequest(url: url)","","\/\/ 캐시 정책 할당 (로컬 캐시 데이터 무시)","request.cachePolicy = .reloadIgnoringLocalCacheData "],"syntax":"swift"},{"type":"thematicBreak"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"참고링크"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"https:\/\/developer.apple.com\/documentation\/foundation\/urlsessionconfiguration","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"https:\/\/developer.apple.com\/documentation\/foundation\/nsurlrequest\/cachepolicy"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"https:\/\/medium.nextlevelswift.com\/urlrequest-cache-policy-f7c30a96b698"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"https:\/\/www.blog-dreamus.com\/post\/cache-control-%EC%9D%B4-%ED%95%84%EC%9A%94%ED%95%9C-%EC%9D%B4%EC%9C%A0"}]}]}]}]}],"type":"unorderedList"}],"kind":"content"}],"references":{"doc://AriNote/documentation/AriNote":{"kind":"symbol","type":"topic","identifier":"doc:\/\/AriNote\/documentation\/AriNote","abstract":[{"type":"codeVoice","code":"Today I Learned"}],"url":"\/documentation\/arinote","title":"Ari's Notes","role":"collection"},"doc://AriNote/documentation/AriNote/Swift":{"identifier":"doc:\/\/AriNote\/documentation\/AriNote\/Swift","role":"collectionGroup","abstract":[{"type":"text","text":"언어 공부"}],"kind":"article","title":"Swift","url":"\/documentation\/arinote\/swift","type":"topic"},"https://i.imgur.com/4EWNm90.gif":{"variants":[{"url":"https:\/\/i.imgur.com\/4EWNm90.gif","traits":["1x","light"]}],"alt":null,"type":"image","identifier":"https:\/\/i.imgur.com\/4EWNm90.gif"}}}