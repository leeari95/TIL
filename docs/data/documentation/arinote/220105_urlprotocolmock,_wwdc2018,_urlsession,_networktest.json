{"kind":"article","primaryContentSections":[{"kind":"content","content":[{"anchor":"TIL-Today-I-Learned","type":"heading","level":1,"text":"TIL (Today I Learned)"},{"inlineContent":[{"text":"1월 5일 (수)","type":"text"}],"type":"paragraph"},{"text":"학습 내용","level":2,"anchor":"%ED%95%99%EC%8A%B5-%EB%82%B4%EC%9A%A9","type":"heading"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"오픈 마켓 프로젝트 STEP 1 테스트 진행"}]},{"items":[{"content":[{"inlineContent":[{"text":"URLProtocol을 Mock으로 만들어서 네트워크 테스트 진행하기","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"type":"text","text":" "}]},{"anchor":"%EA%B3%A0%EB%AF%BC%ED%95%9C-%EC%A0%90--%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95","text":"고민한 점 \/ 해결 방법","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"[URLProtocol?]","type":"text"}],"type":"strong"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"야곰닷넷의 Unit Test강의를 참고하여 테스트코드를 위한 Mock 객체를 구현하다가 마주하게 된 경고"}],"type":"paragraph"}]}]},{"syntax":"swift","code":["class StubURLSessionDataTask: URLSessionDataTask {","    var dummyData: DummyData?","","    \/\/ init 부분에서 에러가 났다.","    init(dummy: DummyData?, completionHandler: DataTaskCompletionHandler?) {","        self.dummyData = dummy","        self.dummyData?.completionHandler = completionHandler","    }","","    override func resume() {","        dummyData?.completion()","    }","}"],"type":"codeListing"},{"content":[{"type":"paragraph","inlineContent":[{"code":"'init()' was deprecated in iOS 13.0: Please use -[NSURLSession dataTaskWithRequest:] or other NSURLSession methods to create instances","type":"codeVoice"}]}],"name":"Note","type":"aside","style":"note"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"해당 경고를 없애고 싶어 구글링 중에 ","type":"text"},{"code":"URLProtocol","type":"codeVoice"},{"text":"을 발견하게 되었다.","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"https:\/\/forums.raywenderlich.com\/t\/chapter-8-init-deprecated-in-ios-13\/102050\/7"}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"코드만으로 이해가 어려워서 ","type":"text"},{"identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/417\/","type":"reference","isActive":true},{"type":"text","text":" 부분을 공부해보았다."}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"요약"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Testing Network Requests"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Decompose code for testability"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"URLProtocol as a mocking tool"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Tiered testing strategy"}]}]}],"type":"unorderedList"}]}]}]},{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlprotocol"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"https:\/\/i.imgur.com\/YGO4AZM.png","type":"image"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"URLSession은 네트워크 통신을 할 수 있는 high level API를 제공한다."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"반면에 URLProtocol이라는 low level API도 제공한다."}]},{"items":[{"content":[{"inlineContent":[{"text":"네트워크 연결을 열고, request를 쓰고, respnse를 주는 역할이다.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"URLProtocol은 단독으로 쓰이지 않고 상속을 받도록 설계되어져있다. URL 로딩 시스템을 확장할 수 있게 한다.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"URLProtocol을 사용해서 Mock객체를 만들고 Mock response를 만들어서 테스트를 진행할 수 있다.","type":"text"}],"type":"paragraph"}]}]}]},{"content":[{"inlineContent":[{"type":"text","text":"테스트 피라미드"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Unit Test","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"text":"한개의 메소드나 클래스를 테스트하는 가장 작은 단위이다.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"메소드의 성공, 실패등을 테스트한다."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"1분당 수백, 수천개의 테스트를 진행할 수 있다.","type":"text"}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Integration"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"한 개의 기능이 잘 작동하는 지를 테스트 하는 것"}]}]},{"content":[{"inlineContent":[{"text":"여러 계층으로 연결된 클래스나 메소드가 잘 동작하는지 확인한다.","type":"text"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"End-to-end"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"하나의 프로그램이나 앱이 잘 동작하는지를 테스트 하는 것이다.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"사용자가 기기에서 수행하는 동작들을 테스트 한다.","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"주로 UI Test로 진행한다.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"앱 내부 뿐만 아니라 OS나 외부 리소스와도 잘 상호작용 하는지 확인한다.","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"image","identifier":"https:\/\/i.imgur.com\/ffJ16Vh.png"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"URLRequest를 준비하고"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"task가 서버와 통신을 하고","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"통신한 데이터를 파싱하고"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"파싱한 데이터를 뷰에 뿌려준다.","type":"text"}]}]}],"type":"unorderedList"},{"type":"thematicBreak"},{"inlineContent":[{"inlineContent":[{"type":"text","text":"[공부하다 메모한 흔적]"}],"type":"strong"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"테스트 기법중 하나를 메모…"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"네트워크나 혹은 여러 side-effact에 강하게 커플링이 되어있는 객체를 가지고 테스트를 할 때에는 외부에서 가짜 데이터를 제공하는 어떤 Stub, 혹은 Mock 객체를 넣고 그 동작을 테스트 할 수 있는 것"}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"resume()은 왜 호출해주는 걸까?","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"dataTask는 기본적으로 일시정지(suspended)상태로 시작하기 때문이다. dataTask를 시작해주기 위해 resume()을 호출하는 것이다."}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"몰랐는데… URLRequest의 HTTPMethod의 기본값은 GET이였다."}]}]}],"type":"unorderedList"},{"type":"thematicBreak"},{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"text","text":"[이해를 위해 프로젝트에서 작성한 코드 설명해보기]"}],"type":"strong"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MockURLProtocol"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"URL 데이터 로딩을 다루는 추상클래스"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"URLProtocol은 URLProtocolClient 프로토콜을 통해 네트워크 진행 상황을 전달한다."}]}]},{"content":[{"inlineContent":[{"type":"text","text":"테스트 번들에서 MockURLProtocol 클래스를 만들고 메소드를 재정의 해준다."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"로드를 할 때 설정한 후 전달할 Data, Error, Response를 딕셔너리로 설정해준다."}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"이 값은 URLProtocol에 연결하여 설정값을 세팅해주기 위한 값이 된다."}],"type":"paragraph"}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Unit Test를 위해 상속받아서 오버라이드 함으로써 커스텀 하여 Mock 객체를 새롭게 만들 수 있다."}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"기존처럼 외부 네트워크에 요청을 직접 보내는 동작이 아니라, 요청을 가로채서 원하는 응답을 반환하게 끔 커스텀 하는 작업이다.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"즉 원래 같이 웹 서버에서 데이터를 불러오는 과정이 아니고, 내가 설정한 값(data, response)을 그대로 반환하게 만들어 주는 과정인 것이다."}],"type":"paragraph"}]}]}]}],"type":"unorderedList"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"MockSession"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"앞서 만든 프로토콜을 URLSession의 configuration에 넣어주면 개발자가 임의로 작성한 로직이 URLSession 내부에서 실행될 것이다."}]}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"NetworkManager 테스트코드","type":"codeVoice"}]},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"테스트코드를 작성할 때에는 원하는 결과 값(url, data, response)을 mockURLs 딕셔너리 값에 대입해주고 그걸 토대로 성공, 혹은 실패에 대한 네트워크 테스트를 진행한다."}]}]}],"type":"unorderedList"}]}],"type":"unorderedList"},{"type":"thematicBreak"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"참고링크"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/417\/","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"https:\/\/developer.apple.com\/documentation\/foundation\/urlprotocol"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"https:\/\/velog.io\/@seunkim\/WWDC18-Testing-Tips-Tricks1-Testing-network-requests","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"https:\/\/velog.io\/@leeyoungwoozz\/TIL-2021.05.21-Fri"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"https:\/\/velog.io\/@minni\/URLSession-URLSessionConfiguration-URLSessionTask"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"https:\/\/www.youtube.com\/watch?v=meTnd09Pf_M&t=229s","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"https:\/\/forums.raywenderlich.com\/t\/chapter-8-init-deprecated-in-ios-13\/102050\/7"}],"type":"paragraph"}]}]}]}]}]}],"identifier":{"url":"doc:\/\/AriNote\/documentation\/AriNote\/220105_URLProtocolMock,_WWDC2018,_URLSession,_NetworkTest","interfaceLanguage":"swift"},"hierarchy":{"paths":[["doc:\/\/AriNote\/documentation\/AriNote","doc:\/\/AriNote\/documentation\/AriNote\/Swift"]]},"metadata":{"title":"220105 URLProtocolMock, WWDC2018, URLSession, NetworkTest","roleHeading":"Article","role":"article","modules":[{"name":"Ari's Notes"}]},"schemaVersion":{"minor":3,"patch":0,"major":0},"sections":[],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/arinote\/220105_urlprotocolmock,_wwdc2018,_urlsession,_networktest"]}],"references":{"https://i.imgur.com/ffJ16Vh.png":{"alt":null,"identifier":"https:\/\/i.imgur.com\/ffJ16Vh.png","variants":[{"url":"https:\/\/i.imgur.com\/ffJ16Vh.png","traits":["1x","light"]}],"type":"image"},"https://developer.apple.com/documentation/foundation/urlprotocol":{"identifier":"https:\/\/developer.apple.com\/documentation\/foundation\/urlprotocol","title":"How to Use URLProtocol","type":"link","titleInlineContent":[{"type":"text","text":"How to Use URLProtocol"}],"url":"https:\/\/developer.apple.com\/documentation\/foundation\/urlprotocol"},"https://developer.apple.com/videos/play/wwdc2018/417/":{"identifier":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/417\/","title":"WWDC 2018 Testing Tips & Tricks","type":"link","titleInlineContent":[{"text":"WWDC 2018 Testing Tips & Tricks","type":"text"}],"url":"https:\/\/developer.apple.com\/videos\/play\/wwdc2018\/417\/"},"doc://AriNote/documentation/AriNote/Swift":{"identifier":"doc:\/\/AriNote\/documentation\/AriNote\/Swift","role":"collectionGroup","abstract":[{"type":"text","text":"언어 공부"}],"kind":"article","title":"Swift","url":"\/documentation\/arinote\/swift","type":"topic"},"https://i.imgur.com/YGO4AZM.png":{"alt":null,"identifier":"https:\/\/i.imgur.com\/YGO4AZM.png","variants":[{"url":"https:\/\/i.imgur.com\/YGO4AZM.png","traits":["1x","light"]}],"type":"image"},"doc://AriNote/documentation/AriNote":{"kind":"symbol","type":"topic","identifier":"doc:\/\/AriNote\/documentation\/AriNote","abstract":[{"type":"codeVoice","code":"Today I Learned"}],"url":"\/documentation\/arinote","title":"Ari's Notes","role":"collection"}}}