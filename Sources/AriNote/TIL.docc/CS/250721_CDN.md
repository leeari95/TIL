# 250721 CDN

이미지 URL 요청 시 CDN을 활용하고 있는데,  정확히 이해하고 싶다!


7월 21일 (월)


# 학습내용


- CDN 개념과 동작 원리
- 서버에서 이미지 리사이징, 크롭, 포맷 변환이 어떻게 이루어지는가?
- 실무에서 성능/비용 최적화 사례


# 고민한 점 / 해결방법


## CDN 개념과 동작 원리

### 1. CDN 개념

![image](https://github.com/user-attachments/assets/3286a20b-ec28-4525-9fa4-255fc4c798c7)

CDN은 정적 자산(이미지, JS, CSS, 영상 등)을 전 세계에 분산된 서버(edge server)에 캐시해두고, 사용자 요청에 가장 가까운 위치에서 응답해주는 성능 최적화 네트워크

* 핵심 역할
  * 속도 향상
  * 서버 부하 감소
  * 트래픽 비용 절감

### 2. CDN 동작 원리

* URL 기반 캐싱 구조:
  * CDN은 기본적으로 요청 URL 전체를 캐시 키(cache key)로 사용한다.
  * 즉, 다음 두 URL은 서로 다른 이미지로 처리된다.
    * https://img.example.com/cover.jpg?w=549&h=702
    * https://img.example.com/cover.jpg?w=365&h=467
  * 따라서 쿼리파라미터가 조금만 달라도 CDN은 새 이미지로 취급하며, 중복 캐시 발생, CDN 비용이 증가하게 된다.
* 정적 자산 캐싱 전략:
  * Cache key
    * CDN은 기본적으로 URL을 키로 사용하지만 이부 CDN은 커스터마이징이 가능하다.
    * 이미지 서버의 경우 대부분 파라미터까지 포함한 URL을 키로 사용한다.
  * TTL (Time-To-Live)
    * 특정 자산을 CDN이 얼마나 유지할지를 결정하는 설정이다.
    * 이미지 썸네일은 일반적으로 TTL을 수시간~수일로 설정한다. (뼌경 빈도가 낮기 때문)
  * Purge (무효화)
    * 원본 이미지가 변경되었을 때, 기본 캐시를 제거(무효화)하는 작업
    * purge를 잘못하면 오래된 이미지가 계속 보일 수 있다.
* Cloudflare / CloudFront / Fastly 등 주요 CDN의 이미지 처리:
  * Cloudflare
    * Cloudflare Images나 Image Resizing 기능 제공
    * 파라미터 기반 리사이징 가능
    * 자동 캐시 + 글로벌 배포
  * AWS CloudFront + Lambda@Edge
    * CloudFront는 정적 파일 캐싱 담당
    * Lambda@Edge를 활용하면 파라미터 기반 이미지 가공 가능
    * S3, EC2, MediaConvert 등과 연계
  * Fastly
    * Edge Side Includes (ESI), Varnish 기반 커스터마이징 강점
    * 매우 정교한 캐싱 제어 가능 (캐시 key 조합, 조건별 캐싱 등)
  * 어떤 CDN이든 파라미터가 달라지면 다른 리소스로 취급한다는건 동일하다.

### 3. 서버에서 이미지 리사이징, 크롭, 포맷 변환 처리 방식

* 이미지 처리 방식:
  * 정적 처리 (Static image generation):
    * 사용자가 요청하지 않아도 서버에서 미리 썸네일들을 저장해둠
    * 장점: 빠른 응답
    * 단점: 저장 공간 낭비, 모든 사이즈를 미리 만들어야 함
  * 동적 처리 (On-the-fly generation):
    * 클라이언트가 `?w=300&h=200&fit=crop&format=webp` 처럼 요청하면, 서버에서 실시간 변환
    * 서버에서 이미지 처리 라이브러리를 사용 (Sharp, ImageMagick, Thumbor 등)
    * CDN이 이 결과를 캐시하고, 이후 요청은 서버를 거치지 않음

### 4. 실무적 관점에서 이해 포인트

* 캐시가 공유되는 이유
  * 파라미터가 동일하면 같은 URL → 한번만 리사이징, 이후 재사용 가능
* 비용이 절감되는 이유
  * CDN은 이미지 크기마다 다른 리소스를 만들고 보관한다. → 중복 생성은 비용과 저장소 낭비
  * ex) iOS/Android가 서로 다른 사이즈로 이미지를 요청하면 CDN이 각각 캐시하고, 같은 사이즈로 요청하면 한번 생성된 썸네일을 양 플랫폼에서 재사용 가능
* 속도가 빨라지는 이유
  * 썸네일이 CDN에 캐시되어있으면 서버로 요청 가지 않고 즉시 응답 가능
* 운영 복잡도 감소
  * 썸네일 사이즈를 통일하면 캐시 관리, purge, 잘림 이슈 등 전반적 관리가 쉬워짐


### 요약

- CDN은 전 세계에 분산된 서버에 정적 자산을 캐시하여 응답 속도를 높이고, 서버 부하를 줄이며, 트래픽 비용을 절감하는 인프라 기술이다.
- CDN은 URL 전체를 캐시 키로 사용하므로, 이미지 요청 시 쿼리 파라미터까지 다르면 서로 다른 리소스로 간주된다.
- 이 때문에 플랫폼마다 썸네일 사이즈가 다르면 캐시가 분산되어 중복 리소스가 발생하고, 비용과 성능 측면에서 손해가 생긴다.
- 썸네일 사이즈를 통일하면 캐시 재사용 가능, CDN 트래픽 비용 절감, 속도 향상, 운영 간소화의 효과를 얻을 수 있다.


# 느낀점


- 기존에는 CDN이 그냥 빠르게 이미지를 제공해주는 정도로만 이해했는데, URL과 쿼리 파라미터가 캐시 전략에 직접적인 영향을 준다는 사실을 알게되었다.
- 썸네일 사이즈 통일 이슈가 단순한 UI 문제가 아니라, CDN 리소스 최적화와 연결된 중요한 전략이라는 걸 알게 되었고, 팀 내 논의나 요청에도 더 구조적 이해를 바탕으로 설득력 있게 참여할 수 있을 것 같다.
- iOS 개발자로서도 CDN 동작 방식을 어느 정도 이해해두면, 이미지 품질과 속도 최적화를 모두 고려한 UI 개발이 가능하다는 점에서 의미 있었다.

---


# 참고 링크


- [https://velog.io/@youngblue/CDN%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80](https://velog.io/@youngblue/CDN%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)
- [https://aws.amazon.com/ko/what-is/cdn/](https://aws.amazon.com/ko/what-is/cdn/)
